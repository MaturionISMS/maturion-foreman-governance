# AGENT CONTRACT SCHEMA

## Status
Canonical Governance Specification  
Version: v1  
Authority: Foreman (FM)

---

## 1. Purpose

This document defines the **normative schema** for `.agent` contracts.

A `.agent` file is valid only if it conforms to this schema.
Any agent operating under an invalid `.agent` contract is considered
**unrecruited** and **out of governance**, regardless of outcome.

This schema exists to make agent legitimacy **mechanically enforceable**.

---

## 2. Scope

This schema applies to:
- All `.agent` files in governed repositories
- All agent classes recognized by governance
- All Builder agents operating under `builder.v1.md`

This schema does not define agent behavior; it defines **agent validity**.

---

## 3. Required Top-Level Sections

A valid `.agent` file MUST contain the following top-level sections:

- `agent`
- `governance`
- `scope`
- `capabilities`
- `constraints`
- `enforcement`

Optional sections:
- `doctrines`

Any additional top-level section is invalid unless explicitly added to this schema.

---

## 4. Agent Section (`agent`)

### Required fields

```yaml
agent:
  id: <string>            # Informational identifier
  class: <agent_class>
  profile: <profile_file>
Constraints
agent.class MUST be one of:

builder

reviewer

auditor

overseer

agent.profile MUST:

Reference a file under /governance/profiles

Use an explicit filename (e.g. builder.v1.md)

Match the declared agent class

agent.id is informational only and MUST NOT be used for enforcement logic.

## 5. Governance Section (`governance`)

### Required canonical binding

```yaml
governance:
  canon:
    repository: <org/repo>
    path: /governance/canon
    reference: <branch|tag|commit>
  
  bindings:  # RECOMMENDED: List canonical documents defining agent authority
    - id: <binding-id>
      path: governance/canon/<document>.md
      role: <binding-role>
```

### Constraints

- The canonical governance source MUST be referenced exactly once
- `.agent` files MUST NOT enumerate or duplicate governance content
- `.agent` files MAY include a `bindings` section listing canonical documents that define:
  - Agent authority boundaries
  - Operational protocols
  - Escalation rules
  - Mandatory compliance requirements
- Bindings are **references only** - they MUST NOT duplicate document content
- Violation of canonical binding rules invalidates the agent contract

---

## 6. Prohibited Governance Duplication

`.agent` files MUST NOT include:

- Lists of doctrine files beyond reference-only bindings
- Duplicated content from philosophy documents
- Local interpretations of governance rules
- Extended authority diagrams
- Constitutional principle recitations
- Detailed workflow descriptions (reference protocol documents instead)

Resolution and interpretation of doctrine is the responsibility of canonical governance only.

**This rule enforces the Agent Contract Minimalism Principle.**

**Recommended Alternative**: Add a "Quick Onboarding" section that references `AGENT_ONBOARDING_QUICKSTART.md` and lists key bindings.

---

7. Scope Section (scope)
Required fields
yaml
Copy code
scope:
  repository: <org/repo>
  allowed_paths: [ <glob> ]
  restricted_paths: [ <glob> ]
  escalation_required_paths: [ <glob> ]
Constraints
.agent MUST appear in restricted_paths

governance/** MUST appear in restricted_paths

.github/** MUST appear in either:

restricted_paths, or

escalation_required_paths

allowed_paths MUST NOT include governance-critical paths

Overlapping paths are permitted only if escalation rules are stricter.

## 8. Capabilities Section (`capabilities`)

### Required fields

```yaml
capabilities:
  execute_changes: <boolean>
  modify_tests: <boolean>
  modify_migrations: <boolean>
  mechanical_fixes: <boolean>
  test_execution:  # REQUIRED for application repositories with tests
    enabled: <boolean>
    test_command: <string>  # Command used to run tests
    test_environment:
      runtime: <string>      # Runtime name and version
      test_runner: <string>  # Test runner name and version
      dependencies_command: <string>  # Command to install dependencies
    documentation_path: <string>  # Path to test environment setup docs
```

### Constraints

- Capability flags declare what may be possible, not what is permitted
- Actual permission is determined by scope and escalation rules
- `modify_migrations: true` MUST be paired with migration paths in `escalation_required_paths`
- **`test_execution.enabled` MUST be `true`** for application repositories with automated test suites
- **`test_execution` section MUST be present** if repository contains code with associated tests
- `test_execution.test_command` MUST match the command used by CI test gates
- `test_execution.documentation_path` MUST reference existing documentation file

---

## 9. Constraints Section (`constraints`)

### Required fields

```yaml
constraints:
  governance_interpretation: forbidden
  scope_expansion: forbidden
  zero_test_debt: required
  build_to_green_only: true
  architecture_immutable_during_build: true
  secrets_and_env_config: forbidden
Temporary authorization
If present, the following structure is permitted:

yaml
Copy code
temporary_authorization:
  allowed: true
  granularity: task
  authority: Foreman
Temporary authorization MUST NOT modify default scope or profile semantics.

10. Doctrines Section (doctrines) â€” Optional
If present, the doctrines section MUST:

Declare alignment only

MUST NOT enumerate doctrine files

MUST NOT redefine doctrine semantics

Example (valid):

yaml
Copy code
doctrines:
  build_philosophy_aligned: true
Example (invalid):

yaml
Copy code
doctrines:
  build_philosophy: /BUILD_PHILOSOPHY.md
11. Enforcement Section (enforcement)
Required fields
yaml
Copy code
enforcement:
  on_scope_violation: halt_and_escalate
  on_governance_resolution_failure: halt
  escalation_target: Foreman
The enforcement model MUST be halt-first and escalation-driven.

12. Validation Outcome
A .agent contract is valid only if:

All required sections are present

All constraints in this schema are satisfied

Canonical governance binding is correct

No prohibited duplication exists

Invalid .agent contracts MUST cause:

Agent recruitment failure

CI failure (where enforced)

Immediate halt of agent activity

---

## 13. LOCKED Sections and Protection Protocol

Agent contracts MAY contain **LOCKED sections** that require CS2 approval to modify, per `governance/canon/AGENT_CONTRACT_PROTECTION_PROTOCOL.md`.

### LOCKED Section Requirements

When implementing LOCKED sections in agent contracts:

1. **Use canonical template**: `governance/templates/AGENT_FILE_LOCKED_SECTIONS_TEMPLATE.md`
2. **Include complete metadata**: Lock ID, Lock Reason, Lock Authority, Lock Date, Last Reviewed, Review Frequency
3. **Use visual markers**: ðŸ”’ emoji, "(LOCKED)" suffix, HTML comment boundaries
4. **Register in protection registry**: All LOCKED sections must be registered per AGENT_CONTRACT_PROTECTION_PROTOCOL.md Section 4.4

### Standard LOCKED Sections

The following LOCKED sections are **universal** (apply to all agent types):

- **Pre-Gate Release Validation** â€” Mandatory local gate execution before handover
- **Zero-Warning Handover Enforcement** â€” Mandatory zero-warning validation per EXECUTION_BOOTSTRAP_PROTOCOL.md v1.1.0 Section 5.1

### Agent-Specific LOCKED Sections

Additional LOCKED sections may be required based on agent class:
- **FM agents**: See AGENT_FILE_LOCKED_SECTIONS_TEMPLATE.md Section 4
- **Builder agents**: See AGENT_FILE_LOCKED_SECTIONS_TEMPLATE.md Section 5  
- **Liaison agents**: See AGENT_FILE_LOCKED_SECTIONS_TEMPLATE.md Section 6
- **Administrator agents**: Per CS2 approval

### Modification Protocol

Modification of LOCKED sections requires:
1. **Identification** of LOCKED section requiring change
2. **Justification** with governance rationale
3. **CS2 approval** via formal change request
4. **Propagation** to all affected contracts (governance + consumer repos)
5. **Registry update** in protection registry

**Authority**: `governance/canon/AGENT_CONTRACT_PROTECTION_PROTOCOL.md`, `governance/templates/AGENT_FILE_LOCKED_SECTIONS_TEMPLATE.md`

---

## 14. Canonical Precedence
This schema is canonical.

If a conflict exists between this schema and any .agent file,
this schema prevails.

If a conflict exists between this schema and a governance profile,
canonical governance prevails.
