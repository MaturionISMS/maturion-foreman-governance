{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://maturion.com/schemas/builder-qa/GOVERNANCE_COMPLIANCE_REPORT.schema.json",
  "title": "Governance Compliance Report Schema",
  "description": "Schema for governance compliance reports generated by Builder agents. This report validates that the build process followed all governance requirements and constitutional rules.",
  "type": "object",
  "required": [
    "schema_version",
    "report_timestamp",
    "builder_id",
    "issue_number",
    "compliance_status",
    "governance_checks"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "description": "Version of this schema (semver format)",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "const": "1.0.0"
    },
    "report_timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp when report was generated",
      "format": "date-time"
    },
    "builder_id": {
      "type": "string",
      "description": "Identifier of the builder agent"
    },
    "issue_number": {
      "type": "integer",
      "description": "GitHub issue number",
      "minimum": 1
    },
    "compliance_status": {
      "type": "string",
      "description": "Overall governance compliance status",
      "enum": ["COMPLIANT", "NON_COMPLIANT", "REQUIRES_REVIEW"]
    },
    "governance_checks": {
      "type": "object",
      "description": "Individual governance compliance checks",
      "required": [
        "build_philosophy_compliance",
        "zero_test_debt_compliance",
        "scope_isolation",
        "evidence_completeness"
      ],
      "properties": {
        "build_philosophy_compliance": {
          "type": "object",
          "description": "Compliance with Build Philosophy (One-Time Build Law)",
          "required": ["compliant", "details"],
          "properties": {
            "compliant": {
              "type": "boolean"
            },
            "details": {
              "type": "string",
              "description": "Details of compliance check"
            },
            "violations": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "zero_test_debt_compliance": {
          "type": "object",
          "description": "Compliance with Zero Test Debt rule",
          "required": ["compliant", "test_debt_count"],
          "properties": {
            "compliant": {
              "type": "boolean"
            },
            "test_debt_count": {
              "type": "integer",
              "minimum": 0,
              "description": "Number of test debt instances (must be 0 for compliance)"
            },
            "test_debt_details": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": ["SKIP", "TODO", "DISABLED", "INCOMPLETE"]
                  },
                  "location": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "scope_isolation": {
          "type": "object",
          "description": "Single responsibility / scope isolation compliance",
          "required": ["compliant"],
          "properties": {
            "compliant": {
              "type": "boolean"
            },
            "responsibility_domain": {
              "type": "string",
              "description": "The single responsibility domain for this PR"
            },
            "scope_violations": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "evidence_completeness": {
          "type": "object",
          "description": "Evidence trail completeness check",
          "required": ["compliant", "required_artifacts"],
          "properties": {
            "compliant": {
              "type": "boolean"
            },
            "required_artifacts": {
              "type": "array",
              "description": "List of required evidence artifacts",
              "items": {
                "type": "object",
                "required": ["name", "present"],
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "present": {
                    "type": "boolean"
                  },
                  "path": {
                    "type": "string"
                  }
                }
              }
            },
            "missing_artifacts": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "test_dodging_check": {
          "type": "object",
          "description": "Check for test dodging (forbidden behavior)",
          "properties": {
            "clean": {
              "type": "boolean",
              "description": "True if no test dodging detected"
            },
            "violations": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": [
                      "SKIP_USED",
                      "ONLY_USED",
                      "TEST_COMMENTED_OUT",
                      "CONDITIONAL_SKIP",
                      "ERROR_SUPPRESSION",
                      "EMPTY_CATCH",
                      "COVERAGE_REDUCTION"
                    ]
                  },
                  "location": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "architecture_followed": {
          "type": "object",
          "description": "Whether architecture phase preceded implementation",
          "properties": {
            "compliant": {
              "type": "boolean"
            },
            "architecture_reference": {
              "type": "string",
              "description": "Reference to architecture document"
            }
          }
        }
      }
    },
    "iso_27001_alignment": {
      "type": "object",
      "description": "ISO 27001 compliance indicators",
      "properties": {
        "security_controls_validated": {
          "type": "boolean"
        },
        "change_management_followed": {
          "type": "boolean"
        },
        "audit_trail_complete": {
          "type": "boolean"
        }
      }
    },
    "violations": {
      "type": "array",
      "description": "List of governance violations detected",
      "items": {
        "type": "object",
        "required": ["rule", "severity", "description"],
        "properties": {
          "rule": {
            "type": "string",
            "description": "Governance rule that was violated"
          },
          "severity": {
            "type": "string",
            "enum": ["CRITICAL", "HIGH", "MEDIUM", "LOW"]
          },
          "description": {
            "type": "string",
            "description": "Description of the violation"
          },
          "remediation": {
            "type": "string",
            "description": "Suggested remediation"
          }
        }
      }
    },
    "compliance_notes": {
      "type": "string",
      "description": "Additional compliance notes"
    }
  },
  "additionalProperties": false
}
